"use strict";export class jFSMRouter{static Create(t){return new jFSMRouter(t)}t=new RegExp(/\/(:\w+)\[(?:09|AZ)]\/(?:.+\/)?(\1)(?:\[(?:09|AZ)]|\/|$)/g);i=new RegExp(/(?<=^|\/):(\w+)(?:\[(09|AZ)])?(?=\/|$)/g);h=[];o=void 0;u=void 0;l=!1;v=[];A=!1;p;S={};g={};constructor(t){window.addEventListener("hashchange",this.CheckHash.bind(this)),this.StateAdd(t),this.p=t}StateAdd(t){let i=!1;return void 0===this.S[t]&&(this.S[t]={OnEnter:[],OnLeave:[]},this.g[t]={},i=!0),i}StateDel(t){let i=!1;if(void 0!==this.S[t]){delete this.S[t],void 0!==this.g[t]&&delete this.g[t];for(const i in this.g)void 0!==this.g[i][t]&&delete this.g[i][t];i=!0}return i}StateOnEnterAdd(t,i){let s=!1;return void 0!==this.S[t]&&(this.S[t].OnEnter.includes(i)||(this.S[t].OnEnter.push(i),s=!0)),s}StateOnEnterDel(t,i){let s=!1;if(void 0!==this.S[t]){const e=this.S[t].OnEnter.indexOf(i);-1!==e&&(this.S[t].OnEnter.splice(e,1),s=!0)}return s}StateOnLeaveAdd(t,i){let s=!1;return void 0!==this.S[t]&&(this.S[t].OnLeave.includes(i)||(this.S[t].OnLeave.push(i),s=!0)),s}StateOnLeaveDel(t,i){let s=!1;if(void 0!==this.S[t]){const e=this.S[t].OnLeave.indexOf(i);-1!==e&&(this.S[t].OnLeave.splice(e,1),s=!0)}return s}TransitionAdd(t,i){let s=!1;return void 0!==this.S[t]&&void 0!==this.S[i]&&void 0===this.g[t][i]&&(this.g[t][i]={OnBefore:[],OnAfter:[]},s=!0),s}TransitionDel(t,i){let s=!1;return void 0!==this.S[t]&&void 0!==this.S[i]&&void 0!==this.g[t][i]&&(delete this.g[t][i],s=!0),s}TransitionOnBeforeAdd(t,i,s){let e=!1;return void 0!==this.S[t]&&void 0!==this.S[i]&&void 0!==this.g[t][i]&&(this.g[t][i].OnBefore.push(s),e=!0),e}TransitionOnBeforeDel(t,i,s){let e=!1;if(void 0!==this.S[t]&&void 0!==this.S[i]&&void 0!==this.g[t][i]){const h=this.g[t][i].OnBefore.indexOf(s);-1!==h&&(this.g[t][i].OnBefore.splice(h,1),e=!0)}return e}TransitionOnAfterAdd(t,i,s){let e=!1;return void 0!==this.S[t]&&void 0!==this.S[i]&&void 0!==this.g[t][i]&&(this.g[t][i].OnAfter.push(s),e=!0),e}TransitionOnAfterDel(t,i,s){let e=!1;if(void 0!==this.S[t]&&void 0!==this.S[i]&&void 0!==this.g[t][i]){const h=this.g[t][i].OnAfter.indexOf(s);-1!==h&&(this.g[t][i].OnAfter.splice(h,1),e=!0)}return e}StateGet(){return this.p}async StateSet(t){let i=!1;if(!this.A){if(void 0!==this.S[t]&&void 0!==this.g[this.p]&&void 0!==this.g[this.p][t]){let s;i=!0,s=this.g[this.p][t].OnBefore.length;for(let e=0;i&&e<s;e++)if("function"==typeof this.g[this.p][t].OnBefore[e]){let s=null;s="AsyncFunction"===this.g[this.p][t].OnBefore[e].constructor.name?await this.g[this.p][t].OnBefore[e]():this.g[this.p][t].OnBefore[e](),i=!1!==s}if(i){s=this.S[this.p].OnLeave.length;for(let i=0;i<s;i++)"function"==typeof this.S[this.p].OnLeave[i]&&("AsyncFunction"===this.S[this.p].OnLeave[i].constructor.name?await this.S[this.p].OnLeave[i](this.p,t):this.S[this.p].OnLeave[i](this.p,t));let i=this.p;this.p=t,s=this.g[i][this.p].OnAfter.length;for(let t=0;t<s;t++)"function"==typeof this.g[i][this.p].OnAfter[t]&&("AsyncFunction"===this.g[i][this.p].OnAfter[t].constructor.name?await this.g[i][this.p].OnAfter[t]():this.g[i][this.p].OnAfter[t]());s=this.S[this.p].OnEnter.length;for(let t=0;t<s;t++)"function"==typeof this.S[this.p].OnEnter[t]&&("AsyncFunction"===this.S[this.p].OnEnter[t].constructor.name?await this.S[this.p].OnEnter[t](this.p,i):this.S[this.p].OnEnter[t](this.p,i))}}this.A=!1}return i}CheckTransition(t){let i=!1;return this.A||void 0!==this.S[t]&&void 0!==this.g[this.p]&&void 0!==this.g[this.p][t]&&(i=!0),i}RouteSpecialAdd(t,i){let s=!1;switch(t){case 403:this.o=i,s=!0;break;case 404:this.u=i,s=!0;break;default:throw new RangeError}return s}RouteAdd(t,i,s,e,h){let n=!1;if(void 0===this.S[t])throw new SyntaxError("Non-existent state");if(i.match(this.t))throw new SyntaxError("Duplicate path id");{let o=0;const r=i.split("/"),a=r.length;for(let t=0;t<a;t++)r[t].startsWith(":")||(o+=2**(a-t-1));let d=new RegExp("^"+i.replace(this.i,(function(t,i,s){let e="(?<"+i+">[";switch(s){case"09":e+="\\d";break;case"AZ":e+="a-zA-Z";break;default:e+="\\w"}return e+="]+)",e})).replace(/\//g,"\\/")+"$");const u=i.replace(this.i,":$2");this.h.find((t=>u===t.path))||(this.h.push({path:u,validState:t,match:d,weight:o,routeFunction:s,available:e,routeFunction403:h}),this.h.sort(((t,i)=>t.weight>i.weight?-1:i.weight>t.weight?1:0)),n=!0)}return n}RouteDel(t){let i=!1;if(t.match(this.t))throw new SyntaxError("Duplicate path id");{const s=t.replace(this.i,":$2"),e=this.h.findIndex((t=>s==t.path));-1<e&&(this.h.splice(e,1),i=!0)}return i}Trigger(t){"#"+t!=window.location.hash&&(window.location.hash="#"+t)}async Route(t){let i;this.l=!0;let s="",e=null;for(const h of this.h)if(e=h.match.exec(t)){s=h.path;let n=!0;h.available&&(n=!1,"function"==typeof h.available&&(n="AsyncFunction"===h.available.constructor.name?await h.available(s,t,e.groups??{}):h.available(s,t,e.groups??{}))),n&&(void 0===h.validState||this.p===h.validState||this.CheckTransition(h.validState))?(h.validState&&this.p!==h.validState&&await this.StateSet(h.validState),i=h.routeFunction):h.routeFunction403?i=h.routeFunction403:this.o&&(i=this.o);break}i&&"function"==typeof i||this.u&&(i=this.u),i&&"function"==typeof i&&("AsyncFunction"===i.constructor.name?await i(s,t,e?.groups??{}):i(s,t,e?.groups??{})),this.v.length?await this.Route(this.v.shift()):this.l=!1}async CheckHash(){const t=window.location.hash.startsWith("#")?window.location.hash.substring(1):"";""!=t&&(this.l?this.v.push(t):await this.Route(t))}}
"use strict";export class jFSMRouter{static Create(t){return new jFSMRouter(t)}t=new RegExp(/\/(:\w+)(?:\[(?:09|AZ|AZ09)])?\/(?:.+\/)?(\1)(?:\[(?:09|AZ|AZ09)])?(?:\/|$)/g);i=new RegExp(/(?<=^|\/):(\w+)(?:\[(09|AZ|AZ09)])?(?=\/|$)/g);h=[];o=void 0;u=void 0;l=void 0;v=!1;A=[];S=!1;p;F={};Z={};constructor(t){window.addEventListener("hashchange",this.CheckHash.bind(this)),this.StateAdd(t),this.p=t}static CheckRouteEquivalence(t,i){const s=t=>{let i=[t];return t.includes(":AZ09")&&i.push(...s(t.replace(/:AZ09/,":AZ")),...s(t.replace(/:AZ09/,":09"))),i},e=new Set(s(t));return[...s(i)].some((t=>e.has(t)))}StateAdd(t){let i=!1;return void 0===this.F[t]&&(this.F[t]={OnEnter:[],OnLeave:[]},this.Z[t]={},i=!0),i}StateDel(t){let i=!1;if(void 0!==this.F[t]){delete this.F[t],void 0!==this.Z[t]&&delete this.Z[t];for(const i in this.Z)void 0!==this.Z[i][t]&&delete this.Z[i][t];i=!0}return i}StateOnEnterAdd(t,i){let s=!1;return void 0!==this.F[t]&&(this.F[t].OnEnter.includes(i)||(this.F[t].OnEnter.push(i),s=!0)),s}StateOnEnterDel(t,i){let s=!1;if(void 0!==this.F[t]){const e=this.F[t].OnEnter.indexOf(i);-1!==e&&(this.F[t].OnEnter.splice(e,1),s=!0)}return s}StateOnLeaveAdd(t,i){let s=!1;return void 0!==this.F[t]&&(this.F[t].OnLeave.includes(i)||(this.F[t].OnLeave.push(i),s=!0)),s}StateOnLeaveDel(t,i){let s=!1;if(void 0!==this.F[t]){const e=this.F[t].OnLeave.indexOf(i);-1!==e&&(this.F[t].OnLeave.splice(e,1),s=!0)}return s}TransitionAdd(t,i){let s=!1;return void 0!==this.F[t]&&void 0!==this.F[i]&&void 0===this.Z[t][i]&&(this.Z[t][i]={OnBefore:[],OnAfter:[]},s=!0),s}TransitionDel(t,i){let s=!1;return void 0!==this.F[t]&&void 0!==this.F[i]&&void 0!==this.Z[t][i]&&(delete this.Z[t][i],s=!0),s}TransitionOnBeforeAdd(t,i,s){let e=!1;return void 0!==this.F[t]&&void 0!==this.F[i]&&void 0!==this.Z[t][i]&&(this.Z[t][i].OnBefore.push(s),e=!0),e}TransitionOnBeforeDel(t,i,s){let e=!1;if(void 0!==this.F[t]&&void 0!==this.F[i]&&void 0!==this.Z[t][i]){const h=this.Z[t][i].OnBefore.indexOf(s);-1!==h&&(this.Z[t][i].OnBefore.splice(h,1),e=!0)}return e}TransitionOnAfterAdd(t,i,s){let e=!1;return void 0!==this.F[t]&&void 0!==this.F[i]&&void 0!==this.Z[t][i]&&(this.Z[t][i].OnAfter.push(s),e=!0),e}TransitionOnAfterDel(t,i,s){let e=!1;if(void 0!==this.F[t]&&void 0!==this.F[i]&&void 0!==this.Z[t][i]){const h=this.Z[t][i].OnAfter.indexOf(s);-1!==h&&(this.Z[t][i].OnAfter.splice(h,1),e=!0)}return e}StateGet(){return this.p}async StateSet(t){let i=!1;if(!this.S){if(this.S=!0,void 0!==this.F[t]&&void 0!==this.Z[this.p]&&void 0!==this.Z[this.p][t]){let s;i=!0,s=this.Z[this.p][t].OnBefore.length;for(let e=0;i&&e<s;e++)if("function"==typeof this.Z[this.p][t].OnBefore[e]){let s=null;s="AsyncFunction"===this.Z[this.p][t].OnBefore[e].constructor.name?await this.Z[this.p][t].OnBefore[e]():this.Z[this.p][t].OnBefore[e](),i=!1!==s}if(i){s=this.F[this.p].OnLeave.length;for(let i=0;i<s;i++)"function"==typeof this.F[this.p].OnLeave[i]&&("AsyncFunction"===this.F[this.p].OnLeave[i].constructor.name?await this.F[this.p].OnLeave[i](this.p,t):this.F[this.p].OnLeave[i](this.p,t));let i=this.p;this.p=t,s=this.Z[i][this.p].OnAfter.length;for(let t=0;t<s;t++)"function"==typeof this.Z[i][this.p].OnAfter[t]&&("AsyncFunction"===this.Z[i][this.p].OnAfter[t].constructor.name?await this.Z[i][this.p].OnAfter[t]():this.Z[i][this.p].OnAfter[t]());s=this.F[this.p].OnEnter.length;for(let t=0;t<s;t++)"function"==typeof this.F[this.p].OnEnter[t]&&("AsyncFunction"===this.F[this.p].OnEnter[t].constructor.name?await this.F[this.p].OnEnter[t](this.p,i):this.F[this.p].OnEnter[t](this.p,i))}}this.S=!1}return i}CheckTransition(t){let i=!1;return this.S||void 0!==this.F[t]&&void 0!==this.Z[this.p]&&void 0!==this.Z[this.p][t]&&(i=!0),i}RouteSpecialAdd(t,i){let s=!1;switch(t){case 403:this.o=i,s=!0;break;case 404:this.u=i,s=!0;break;case 500:this.l=i,s=!0;break;default:throw new RangeError}return s}RouteAdd(t,i,s,e,h){let n=!1;if(void 0===this.F[t])throw new SyntaxError("Non-existent state");if(i.match(this.t))throw new SyntaxError("Duplicate path id");{let o=0;const r=i.split("/"),a=r.length;for(let t=0;t<a;t++)r[t].startsWith(":")||(o+=2**(a-t-1));let d=new RegExp("^"+i.replace(this.i,(function(t,i,s){let e="(?<"+i+">[";switch(s){case"09":e+="\\d";break;case"AZ":e+="a-zA-Z";break;default:e+="a-zA-Z\\d"}return e+="]+)",e})).replace(/\//g,"\\/")+"$");const u=i.replace(this.i,((t,i,s)=>`:${s??"AZ09"}`));this.h.find((t=>jFSMRouter.CheckRouteEquivalence(u,t.path)))||(this.h.push({path:u,validState:t,match:d,weight:o,routeFunction:s,available:e,routeFunction403:h}),this.h.sort(((t,i)=>t.weight>i.weight?-1:i.weight>t.weight?1:0)),n=!0)}return n}RouteDel(t){let i=!1;if(t.match(this.t))throw new SyntaxError("Duplicate path id");{const s=t.replace(this.i,((t,i,s)=>`:${s??"AZ09"}`)),e=this.h.findIndex((t=>jFSMRouter.CheckRouteEquivalence(s,t.path)));-1<e&&(this.h.splice(e,1),i=!0)}return i}Trigger(t){"#"+t!=window.location.hash&&(window.location.hash="#"+t)}async Route(t){let i;this.v=!0;let s="",e=null;for(const h of this.h)if(e=h.match.exec(t)){s=h.path;let n=!1;h.available&&"function"==typeof h.available&&(n="AsyncFunction"===h.available.constructor.name?await h.available(s,t,e.groups??{}):h.available(s,t,e.groups??{})),n&&(void 0===h.validState||this.p===h.validState||this.CheckTransition(h.validState))?h.validState&&this.p!==h.validState?(i=h.routeFunction,await this.StateSet(h.validState)||(i=this.l)):i=this.l:h.routeFunction403?i=h.routeFunction403:this.o&&(i=this.o);break}i||this.u&&(i=this.u),"function"!=typeof i&&this.l&&(i=this.l),i&&"function"==typeof i&&("AsyncFunction"===i.constructor.name?await i(s,t,e?.groups??{}):i(s,t,e?.groups??{})),this.A.length?await this.Route(this.A.shift()):this.v=!1}async CheckHash(){const t=window.location.hash.startsWith("#")?window.location.hash.substring(1):"";""!=t&&(this.v?this.A.push(t):await this.Route(t))}}